{% extends "base.html" %}

{% block title %}Patients{% endblock %}

{% block content %}
<h2>Patients</h2>
<a href="/admin/patients/create" class="btn">Add New Patient</a>

<table class="data-table">
    <thead>
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Date of Birth</th>
        <th>Gender</th>
        <th>Phone</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    {% for patient in patients %}
    <tr>
        <td>{{ patient.ID }}</td>
        <td>{{ patient.FirstName }} {{ patient.LastName }}</td>
        <td>{{ patient.DateOfBirth }}</td>
        <td>{{ patient.Gender }}</td>
        <td>{{ patient.PhoneNumber }}</td>
        <td>
            <a href="/admin/patients/{{ patient.ID }}" class="btn btn-sm">View</a>
            <a href="/admin/patients/{{ patient.ID }}/edit" class="btn btn-sm">Edit</a>
            <button onclick="deletePatient({{ patient.ID }})" class="btn btn-sm btn-danger">Delete</button>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>

<script>
    async function deletePatient(id) {
        if (confirm('Are you sure you want to delete this patient?')) {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`/admin/patients/${id}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    window.location.reload();
                } else {
                    const error = await response.json();
                    alert(error.error || 'Failed to delete patient');
                }
            } catch (err) {
                console.error('Error:', err);
                alert('An error occurred while deleting patient');
            }
        }
    }
</script>
{% endblock %}
